(()=>{"use strict";var e={287:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdaptRouteMiddleware=void 0,t.AdaptRouteMiddleware=(...e)=>e.map((e=>async(t,r,o)=>{const s={body:t.body,params:t.params,query:t.query,headers:t.headers,file:t.file},a=await e.handle(s);if(200===a.statusCode)return Object.assign(t.body,a.body),o();r.status(a.statusCode).json(a.body)}))},8809:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdaptRoute=void 0,t.AdaptRoute=e=>async(t,r)=>{const o={body:t.body,params:t.params,query:t.query,headers:t.headers,file:t.file},s=await e.handle(o);r.status(s.statusCode).json(s.body)}},494:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(6860)),a=o(r(5382)),n=r(462),i=o(r(5017)),d=(0,s.default)();(0,a.default)(d),(0,n.middlewares)(d),(0,i.default)(d),t.default=d},5382:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(3698)),a=r(9948);t.default=e=>{e.use("/api-docs",a.serve,(0,a.setup)(s.default))}},4093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mailExpirationTime=t.email=t.token=t.rijndaelKey=t.mongo=t.api=t.corsUrl=t.name=t.port=t.environment=void 0,t.environment="production",t.port=process.env.PORT??"9000",t.name=process.env.NAME_API??"API",t.corsUrl=process.env.CORS_URL??"*",t.api={prefixV1:process.env.PREFIX_API_V1??"/api/v1.0"},t.mongo={uri:process.env.MONGO_URI??"",dbName:process.env.MONGO_DATABASE??""},t.rijndaelKey=process.env.RIJNDAEL_KEY??"",t.token={seed:process.env.SEED??"",expiresIn:+(process.env.EXPIRES_IN??15)},t.email={host:process.env.EMAIL_HOST??"",port:process.env.EMAIL_PORT??"",user:process.env.EMAIL_USER??"",password:process.env.EMAIL_PASSWORD??""},t.mailExpirationTime=1},462:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.middlewares=void 0;const o=r(3864);t.middlewares=e=>{e.use(o.helmet),e.use(o.gzip),e.use(o.cors),e.use(o.bodyParser),e.use(o.bodyUrlEncoded)}},5017:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(3864),s=r(4093),a=r(4611);t.default=e=>{e.get("/status",((e,t)=>{t.status(200).end()})),e.use(s.api.prefixV1,a.routerV1),e.use(o.notFound),e.use(o.errorHandlers)}},1576:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.badRequest=void 0,t.badRequest={description:"Invalid params request",content:{"application/json":{schema:{$ref:"#/schemas/error"}}}}},5126:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(1576),t),s(r(9288),t)},9288:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serverError=void 0,t.serverError={description:"'Something on the server didn't work right'",content:{"application/json":{schema:{$ref:"#/schemas/error"}}}}},3698:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(4093),s=r(5126),a=r(8120),n=r(3132),i=r(6201),d=r(63),u=r(6958),l=r(9963),c=r(3851),p=r(2188),f=r(2444),h=r(1977),m=r(2004),y=r(7407),v=r(9426);t.default={openapi:"3.0.0",info:{title:"Login aluxion",description:"API - Nestor Cortina",version:"1.0"},servers:[{url:o.api.prefixV1}],tags:[{name:"Login"}],paths:{"/signup":d.signupPath,"/login":l.loginPath,"/restore-password":p.sendEmailRestorePassPath,"/restore-password/:hash":m.restorePassPath},schemas:{signup:n.signupSchema,signupParams:a.signupParamsSchema,login:u.loginSchema,loginParams:c.loginParamsSchema,sendEmailRestorePass:f.sendEmailRestorePassSchema,sendEmailRestorePassParams:h.sendEmailRestorePassParamsSchema,restorePass:v.restorePassSchema,restorePassParams:y.restorePassParamsSchema,error:i.errorSchema},components:{badRequest:s.badRequest,serverError:s.serverError}}},9963:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginPath=void 0,t.loginPath={post:{tags:["Login"],summary:"API to login",requestBody:{content:{"application/json":{schema:{$ref:"#/schemas/loginParams"}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/schemas/login"}}}},404:{$ref:"#/components/badRequest"},500:{$ref:"#/components/serverError"}}}}},2004:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restorePassPath=void 0,t.restorePassPath={post:{tags:["Restore password"],summary:"API to restore password",requestBody:{content:{"application/json":{schema:{$ref:"#/schemas/restorePassParams"}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/schemas/restorePass"}}}},404:{$ref:"#/components/badRequest"},500:{$ref:"#/components/serverError"}}}}},6201:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorSchema=void 0,t.errorSchema={type:"object",properties:{message:{type:"string"},statusCode:{type:"string"}}}},3851:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginParamsSchema=void 0,t.loginParamsSchema={type:"object",properties:{email:{type:"string"},password:{type:"string"}},required:["email","password"]}},6958:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginSchema=void 0,t.loginSchema={type:"object",properties:{message:{type:"string"},statusCode:{type:"string"},data:{type:"object",properties:{user:{type:"object",properties:{name:{type:"string"},email:{type:"string"}}},token:{type:"string"}}}}}},7407:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restorePassParamsSchema=void 0,t.restorePassParamsSchema={type:"object",properties:{password:{type:"string"}},required:["password"]}},9426:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restorePassSchema=void 0,t.restorePassSchema={type:"object",properties:{message:{type:"string"},statusCode:{type:"string"}}}},1977:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendEmailRestorePassParamsSchema=void 0,t.sendEmailRestorePassParamsSchema={type:"object",properties:{email:{type:"string"}},required:["email"]}},2444:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendEmailRestorePassSchema=void 0,t.sendEmailRestorePassSchema={type:"object",properties:{message:{type:"string"},statusCode:{type:"string"}}}},8120:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.signupParamsSchema=void 0,t.signupParamsSchema={type:"object",properties:{name:{type:"string"},email:{type:"string"},password:{type:"string"}},required:["name","email","password"]}},3132:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.signupSchema=void 0,t.signupSchema={type:"object",properties:{message:{type:"string"},statusCode:{type:"string"}}}},2188:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendEmailRestorePassPath=void 0,t.sendEmailRestorePassPath={post:{tags:["Send email restore password"],summary:"API to send email restore password",requestBody:{content:{"application/json":{schema:{$ref:"#/schemas/sendEmailRestorePassParams"}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/schemas/sendEmailRestorePass"}}}},404:{$ref:"#/components/badRequest"},500:{$ref:"#/components/serverError"}}}}},63:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.signupPath=void 0,t.signupPath={post:{tags:["Signup"],summary:"API to create user",requestBody:{content:{"application/json":{schema:{$ref:"#/schemas/signupParams"}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/schemas/signup"}}}},404:{$ref:"#/components/badRequest"},500:{$ref:"#/components/serverError"}}}}},429:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeAuthMiddleware=void 0;const o=r(4232),s=r(2705),a=r(7050),n=r(7031),i=r(1900),d=r(4093),u=r(978);t.makeAuthMiddleware=()=>{const e=new s.RijndaelAdapter(10,d.rijndaelKey),t=new n.UserRepository,r=new u.UserService(e,t),l=new a.SessionRepository,c=new i.SessionService(l,r,d.token.expiresIn);return new o.AuthMiddleware(c)}},7273:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeLoginController=void 0;const o=r(7724),s=r(5785),a=r(2705),n=r(7031),i=r(3041),d=r(4093),u=r(978),l=r(7050),c=r(1900);t.makeLoginController=()=>{const e=new a.RijndaelAdapter(10,d.rijndaelKey),t=new n.UserRepository,r=new u.UserService(e,t),p=new i.JwtAdapter(d.token.seed),f=new l.SessionRepository,h=new c.SessionService(f,r,d.token.expiresIn),m=new o.AuthenticationService(r,e,p,h);return new s.LoginController(m)}},4178:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeRestorePasswordController=t.makeSendMailToRestorePasswordController=void 0;const o=r(2705),s=r(7031),a=r(4093),n=r(978),i=r(8200),d=r(674);t.makeSendMailToRestorePasswordController=()=>{const e=new o.RijndaelAdapter(10,a.rijndaelKey),t=new s.UserRepository,r=new n.UserService(e,t),u=new d.RestorePasswordService(r,e);return new i.SendMailToRestorePasswordController(u,r)},t.makeRestorePasswordController=()=>{const e=new o.RijndaelAdapter(10,a.rijndaelKey),t=new s.UserRepository,r=new n.UserService(e,t),u=new d.RestorePasswordService(r,e);return new i.RestorePasswordController(u)}},2541:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeSignupController=void 0;const o=r(7564),s=r(2705),a=r(7031),n=r(978),i=r(4093);t.makeSignupController=()=>{const e=new s.RijndaelAdapter(10,i.rijndaelKey),t=new a.UserRepository,r=new n.UserService(e,t);return new o.SignupController(r)}},6628:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeValidateTokenController=void 0;const o=r(7116);t.makeValidateTokenController=()=>new o.ValidateTokenController},8978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loaders=void 0;const o=r(2282),s=r(8119),a=r(4093);t.loaders=async()=>{await o.MongoHelper.connect(a.mongo.uri,a.mongo.dbName),s.Logger.info(`API PREFIX: ${a.api.prefixV1}`)}},5401:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const n=r(4093),i=r(8978);(async function(){await(0,i.loaders)();const e=(await Promise.resolve().then((()=>a(r(494))))).default;e.set("port",n.port),e.listen(n.port,(()=>{console.info(`########################################################\nðŸ›¡ï¸  Server ${n.name} listening on port: ${n.port} ðŸ›¡ï¸\n########################################################`)})).on("error",(e=>console.error("error in server.listen ",e)))})().catch(console.error)},3978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bodyUrlEncoded=t.bodyParser=void 0;const o=r(6860);t.bodyParser=(0,o.json)(),t.bodyUrlEncoded=(0,o.urlencoded)({extended:!0})},6262:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cors=void 0;const o=r(4093);t.cors=(e,t,r)=>{t.set("access-control-allow-origin",o.corsUrl),t.set("access-control-allow-headers","*"),t.set("access-control-allow-methods","*"),r()}},4251:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandlers=void 0;const o=r(3725),s=r(3097),a=r(8119);t.errorHandlers=(e,t,r,n)=>{if(void 0===e)n();else switch(e.type){case s.ERROR_HANDLERS.SYNTAX_ERROR:(0,o.BadRequestError)(r,"SyntaxError");break;case s.ERROR_HANDLERS.PAYLOAD_TOO_LARGE:(0,o.PayloadTooLargeError)(r);break;default:(0,o.BadRequestError)(r),a.Logger.error("error handlers",e)}}},8574:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.gzip=void 0;const s=o(r(7455));t.gzip=(0,s.default)()},7728:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.helmet=void 0;const s=o(r(7806));t.helmet=(0,s.default)()},3864:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(3978),t),s(r(6262),t),s(r(4251),t),s(r(8574),t),s(r(7728),t),s(r(629),t)},629:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notFound=void 0;const o=r(3725);t.notFound=(e,t)=>(0,o.NotFoundError)(t)},5946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0,t.Session=class{constructor(e,t,r){this.user_id=e,this.token=t,this.expired=r}}},473:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0,t.User=class{constructor(e,t,r,o){this.name=e,this.password=t,this.email=r,this.salt=o}}},7724:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthenticationService=void 0,t.AuthenticationService=class{constructor(e,t,r,o){this.userService=e,this.rijndaelAdapter=t,this.jwtAdapter=r,this.sessionService=o}async auth(e,t){const r=await this.userService.findByEmail(e);if(null===r)return null;if(!1===await this.rijndaelAdapter.decrypt(t,r.password,r.salt))return null;const o=await this.jwtAdapter.token(r._id);return await this.sessionService.create({userId:r._id,token:o}),{user:{name:r.name,email:r.email},token:o}}}},674:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestorePasswordService=void 0;const s=o(r(6113)),a=r(9482),n=r(3405),i=r(3533),d=r(4093);t.RestorePasswordService=class{constructor(e,t,r=a.SendEmail){this.userService=e,this.rijndaelAdapter=t,this.sendEmail=r,this.sendMailToRestorePassword=async e=>{try{const t=s.default.randomBytes(30).toString("hex"),r="hash generated to restore password";n.Logger.info(`${r}: ${t}`);const o=new Date;o.setHours(o.getHours()+d.mailExpirationTime);const a={token:t,expira_token:o};await this.userService.update({email:e},a);const u=["https://example-url.com","restore-password",t].join("/"),l={to:e,subject:"Reset password",text:(0,i.restorePasswordText)(u),html:(0,i.restorePasswordHtml)(u)};return await this.sendEmail(l)}catch(e){throw n.Logger.error("RestorePasswordService sendMailToRestorePassword",e),e}},this.validateHashRestorePassword=async e=>{try{const t=new Date;(new Date).setMinutes(t.getMinutes()+d.mailExpirationTime);const r=await this.userService.findOne({token:e});return null!==r&&r.expira_token>t}catch(e){throw n.Logger.error("RestorePasswordService validateHashRestorePassword",e),e}},this.restorePassword=async(e,t)=>{if(!await this.validateHashRestorePassword(e))return!1;const r=await this.rijndaelAdapter.encrypt(t),{_id:o}=await this.userService.update({token:e},{password:r,salt:this.rijndaelAdapter.saltText});return await this.userService.update({_id:o},{token:null,expira_token:null}),!0}}}},1900:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionService=void 0;const o=r(5946);t.SessionService=class{constructor(e,t,r){this.sessionRepository=e,this.userService=t,this.expiresIn=r}async create({userId:e,token:t}){const r=new Date;r.setMinutes(r.getMinutes()+this.expiresIn);const s=new o.Session(e,t,r);return await this.sessionRepository.create(s)}async validate(e){const t=new Date,r=new Date;r.setMinutes(t.getMinutes()+this.expiresIn);const o=await this.sessionRepository.findByToken(e);if(null===o)return;const{_id:s}=o;if(Reflect.deleteProperty(o,"_id"),t>o.expired)return void await this.sessionRepository.delete({_id:s});o.expired=r,await this.sessionRepository.updateByPk(s,o);const{name:a,email:n}=await this.userService.findByPk(o.user_id);return{token:o.token,user:{name:a,email:n}}}}},978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const o=r(473);t.UserService=class{constructor(e,t){this.rijndaelAdapter=e,this.userRepository=t}async create(e){const{name:t,password:r,email:s}=e,a=await this.rijndaelAdapter.encrypt(r),n=new o.User(t,a,s,this.rijndaelAdapter.saltText);return await this.userRepository.create(n)}async update(e,t){return await this.userRepository.update(e,t)}async findByEmail(e){return await this.userRepository.findByEmail(e)}async findByPk(e){return await this.userRepository.findByPk(e)}async findOne(e){return await this.userRepository.findOne(e)}}},3041:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtAdapter=void 0;const s=o(r(9344));t.JwtAdapter=class{constructor(e){this.seed=e,this.seed=e}async token(e){return s.default.sign({value:e},this.seed)}}},2705:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RijndaelAdapter=void 0;const s=o(r(6113)),a=r(3215);t.RijndaelAdapter=class{constructor(e,t){this.encrypt=async e=>(this.saltBytes=s.default.randomBytes(this.salt),this.saltText=this.saltBytes.toString("base64"),(0,a.Rijndael)(this.saltBytes,this.key,e)),this.decrypt=async(e,t,r)=>(this.saltBytes=Buffer.from(r,"base64"),(0,a.Rijndael)(this.saltBytes,this.key,e)===t),this.key=t,this.salt=e}}},2282:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MongoHelper=void 0;const o=r(8013),s=r(8119);let a,n;t.MongoHelper={async connect(e,t){a=new o.MongoClient(e),await a.connect(),n=a.db(t),s.Logger.info("MongoDB loaded and connected! âœŒï¸")},connection:()=>n,async disconnect(){await a.close(),s.Logger.info("MongoDB disconnected")}}},8276:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultError=void 0;class r extends Error{constructor(e){super(),this.statusCode="4000",this.message=e}}t.DefaultError=r},8797:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(8276),t),s(r(6207),t),s(r(7881),t),s(r(8472),t),s(r(9033),t),s(r(3160),t)},6207:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidParamError=void 0;class r extends Error{constructor(e){super(),this.statusCode="4000",this.message=`InvalidParamError: ${e}`}}t.InvalidParamError=r},7881:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MissingParamError=void 0;class r extends Error{constructor(e){super(),this.statusCode="4000",this.message=`Missing param: ${e}`}}t.MissingParamError=r},8472:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoAlReadyExist=t.AlReadyExist=void 0;class r extends Error{constructor(e){super(),this.statusCode="4000",this.message=`This information already exists in our database: ${e}`}}t.AlReadyExist=r;class o extends Error{constructor(e){super(),this.statusCode="4004",this.message=`This does not exist in our database: ${e}`}}t.NoAlReadyExist=o},9033:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=void 0;class r extends Error{constructor(e){super(),this.statusCode="5000",this.message="Error Internal the Server"}}t.ServerError=r},3160:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnauthorizedInvalidTokenError=t.UnauthorizedError=void 0;class r extends Error{constructor(){super(),this.statusCode="4001",this.message="Incorrect email or password"}}t.UnauthorizedError=r;class o extends Error{constructor(){super(),this.statusCode="4001",this.message="Invalid Token"}}t.UnauthorizedInvalidTokenError=o},5822:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serverError=t.forbidden=t.unauthorized=t.badRequest=t.ok=void 0;const o=r(8884),s=r(9033);t.ok=({message:e="Ok",statusCode:t="2000",data:r}=o.defaultAnswerOk)=>({statusCode:200,body:{message:e,statusCode:t,data:r}}),t.badRequest=e=>({statusCode:400,body:e}),t.unauthorized=e=>({statusCode:401,body:e}),t.forbidden=e=>({statusCode:403,body:e}),t.serverError=e=>({statusCode:500,body:new s.ServerError(e.stack)})},3725:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayloadTooLargeError=t.NotFoundError=t.BadRequestError=void 0,t.BadRequestError=(e,t="bad request")=>e.status(400).json({statusCode:"4000",message:t}),t.NotFoundError=e=>e.status(404).json({statusCode:"4004",message:"not found"}),t.PayloadTooLargeError=(e,t="payload too large")=>e.status(415).json({statusCode:"4000",message:t})},8884:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAnswerOk=void 0,t.defaultAnswerOk={message:"OK",statusCode:"2000"}},5570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3097:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_HANDLERS=void 0,(r=t.ERROR_HANDLERS||(t.ERROR_HANDLERS={})).SYNTAX_ERROR="entity.parse.failed",r.PAYLOAD_TOO_LARGE="entity.too.large"},7318:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8828:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4633:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMiddleware=void 0;const o=r(6538),s=r(8119);t.AuthMiddleware=class{constructor(e){this.sessionService=e}async handle(e){try{const{authorization:t}=e.headers,[,r]=t.split(" "),s=await this.sessionService.validate(r);return void 0===s?(0,o.unauthorized)(new o.UnauthorizedInvalidTokenError):(e.body.session=s,(0,o.ok)())}catch(e){return s.Logger.error("AuthMiddleware",e),(0,o.serverError)(e)}}}},6538:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(5570),t),s(r(8828),t),s(r(7318),t),s(r(8797),t),s(r(5822),t)},9803:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.authMiddleware=void 0;const n=r(6860),i=a(r(3320)),d=r(287),u=r(429),l=r(4232);t.authMiddleware=(0,n.Router)(),t.authMiddleware.use("/",...(0,d.AdaptRouteMiddleware)((0,i.default)(l.schemaAuth,i.ValidationSource.HEADER),(0,u.makeAuthMiddleware)()))},2554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaAuth=void 0;const o=r(286),s=r(4658);t.schemaAuth=s.Validator.object().keys({authorization:(0,o.JoiAuthBearer)().required()}).unknown(!0)},4232:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.authMiddleware=t.schemaAuth=t.AuthMiddleware=void 0;var o=r(4633);Object.defineProperty(t,"AuthMiddleware",{enumerable:!0,get:function(){return o.AuthMiddleware}});var s=r(2554);Object.defineProperty(t,"schemaAuth",{enumerable:!0,get:function(){return s.schemaAuth}});var a=r(9803);Object.defineProperty(t,"authMiddleware",{enumerable:!0,get:function(){return a.authMiddleware}})},3320:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationSource=t.default=void 0;var s=r(286);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o(s).default}});var a=r(286);Object.defineProperty(t,"ValidationSource",{enumerable:!0,get:function(){return a.ValidationSource}})},286:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JoiAuthBearer=t.ValidatorEmail=t.ValidationSource=void 0;const o=r(4658),s=r(8797),a=r(5822);var n;!function(e){e.BODY="body",e.HEADER="headers",e.QUERY="query",e.PARAM="params"}(n=t.ValidationSource||(t.ValidationSource={})),t.ValidatorEmail=e=>o.Validator.string().custom(((t,r)=>e.isValid(t)?t:r.error("any.invalid")),"Email Validation"),t.JoiAuthBearer=()=>o.Validator.string().custom(((e,t)=>e.startsWith("Bearer ")?""===e.split(" ")[1]?t.error("any.invalid"):e:t.error("any.invalid")),"Authorization Header Validation"),t.default=(e,t=n.BODY)=>({async handle(r){const{error:o}=e.validate(r[t]);if(void 0===o)return(0,a.ok)();const{details:n}=o,i=n.map((e=>e.message.replace(/['"]+/g,""))).join(",");return(0,a.badRequest)(new s.InvalidParamError(i))}})},4611:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.routerV1=void 0;const o=r(6860),s=r(5785),a=r(7564),n=r(8200),i=r(7116),d=r(4232);t.routerV1=(0,o.Router)({caseSensitive:!0}),t.routerV1.use("/login",s.loginRoutes),t.routerV1.use("/signup",a.signupRoutes),t.routerV1.use("/restore-password",n.restorePasswordRoutes),t.routerV1.use("/validate-token",d.authMiddleware,i.validateTokenRoutes)},5785:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginRoutes=t.schemaLogin=t.LoginController=void 0;var o=r(197);Object.defineProperty(t,"LoginController",{enumerable:!0,get:function(){return o.LoginController}});var s=r(8113);Object.defineProperty(t,"schemaLogin",{enumerable:!0,get:function(){return s.schemaLogin}});var a=r(9763);Object.defineProperty(t,"loginRoutes",{enumerable:!0,get:function(){return a.loginRoutes}})},197:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginController=void 0;const o=r(5822),s=r(8797),a=r(8119);t.LoginController=class{constructor(e){this.authenticationService=e}async handle(e){try{const{email:t,password:r}=e.body,a=await this.authenticationService.auth(t,r);return null===a?(0,o.unauthorized)(new s.UnauthorizedError):(0,o.ok)({message:"login successfully",data:a})}catch(e){return a.Logger.error("LoginController",e),(0,o.serverError)(e)}}}},9763:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loginRoutes=void 0;const s=r(6860),a=r(287),n=o(r(3320)),i=r(5785),d=r(8809),u=r(7273);t.loginRoutes=(0,s.Router)(),t.loginRoutes.post("/",...(0,a.AdaptRouteMiddleware)((0,n.default)(i.schemaLogin)),(0,d.AdaptRoute)((0,u.makeLoginController)()))},8113:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaLogin=void 0;const o=r(286),s=r(3405),a=r(4658);t.schemaLogin=a.Validator.object().keys({email:(0,o.ValidatorEmail)(s.emailValidator).email().required(),password:a.Validator.string().min(6).max(30).required()})},8200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restorePasswordRoutes=t.schemaRestorePasswordParams=t.schemaRestorePassword=t.schemaSendMailToRestorePassword=t.RestorePasswordController=t.SendMailToRestorePasswordController=void 0;var o=r(5674);Object.defineProperty(t,"SendMailToRestorePasswordController",{enumerable:!0,get:function(){return o.SendMailToRestorePasswordController}}),Object.defineProperty(t,"RestorePasswordController",{enumerable:!0,get:function(){return o.RestorePasswordController}});var s=r(6944);Object.defineProperty(t,"schemaSendMailToRestorePassword",{enumerable:!0,get:function(){return s.schemaSendMailToRestorePassword}}),Object.defineProperty(t,"schemaRestorePassword",{enumerable:!0,get:function(){return s.schemaRestorePassword}}),Object.defineProperty(t,"schemaRestorePasswordParams",{enumerable:!0,get:function(){return s.schemaRestorePasswordParams}});var a=r(6917);Object.defineProperty(t,"restorePasswordRoutes",{enumerable:!0,get:function(){return a.restorePasswordRoutes}})},5674:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RestorePasswordController=t.SendMailToRestorePasswordController=void 0;const o=r(5822),s=r(8119),a=r(8797);t.SendMailToRestorePasswordController=class{constructor(e,t){this.restorePasswordService=e,this.userService=t}async handle(e){try{const{email:t}=e.body;return null===await this.userService.findByEmail(t)?(0,o.badRequest)(new a.NoAlReadyExist("email")):await this.restorePasswordService.sendMailToRestorePassword(t)?(0,o.ok)({message:"A message was sent to your email"}):(0,o.badRequest)(new a.DefaultError("could not send mail, try again later"))}catch(e){return s.Logger.error("RestorePasswordController",e),(0,o.serverError)(e)}}},t.RestorePasswordController=class{constructor(e){this.restorePasswordService=e}async handle(e){try{const{hash:t}=e.params,{password:r}=e.body;return await this.restorePasswordService.restorePassword(t,r)?(0,o.ok)({message:"your password was updated correctly"}):(0,o.badRequest)(new a.DefaultError("invalid hash"))}catch(e){return s.Logger.error("RestorePasswordController",e),(0,o.serverError)(e)}}}},6917:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.restorePasswordRoutes=void 0;const n=r(6860),i=r(287),d=a(r(3320)),u=r(8200),l=r(8809),c=r(4178);t.restorePasswordRoutes=(0,n.Router)(),t.restorePasswordRoutes.post("/",...(0,i.AdaptRouteMiddleware)((0,d.default)(u.schemaSendMailToRestorePassword)),(0,l.AdaptRoute)((0,c.makeSendMailToRestorePasswordController)())),t.restorePasswordRoutes.post("/:hash",...(0,i.AdaptRouteMiddleware)((0,d.default)(u.schemaRestorePassword),(0,d.default)(u.schemaRestorePasswordParams,d.ValidationSource.PARAM)),(0,l.AdaptRoute)((0,c.makeRestorePasswordController)()))},6944:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaRestorePasswordParams=t.schemaRestorePassword=t.schemaSendMailToRestorePassword=void 0;const o=r(286),s=r(3405),a=r(4658);t.schemaSendMailToRestorePassword=a.Validator.object().keys({email:(0,o.ValidatorEmail)(s.emailValidator).email().required()}),t.schemaRestorePassword=a.Validator.object().keys({password:a.Validator.string().min(6).max(30).required()}),t.schemaRestorePasswordParams=a.Validator.object().keys({hash:a.Validator.string().length(60).required()})},7564:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.signupRoutes=t.schemaSignup=t.SignupController=void 0;var o=r(7636);Object.defineProperty(t,"SignupController",{enumerable:!0,get:function(){return o.SignupController}});var s=r(4469);Object.defineProperty(t,"schemaSignup",{enumerable:!0,get:function(){return s.schemaSignup}});var a=r(1073);Object.defineProperty(t,"signupRoutes",{enumerable:!0,get:function(){return a.signupRoutes}})},7636:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SignupController=void 0;const o=r(5822),s=r(8797),a=r(8119);t.SignupController=class{constructor(e){this.userService=e}async handle(e){try{const{name:t,email:r,password:a}=e.body;return null!==await this.userService.findByEmail(r)?(0,o.badRequest)(new s.AlReadyExist(r)):(await this.userService.create({name:t,email:r,password:a}),(0,o.ok)({message:"Successful registration"}))}catch(e){return a.Logger.error("SignupController",e),(0,o.serverError)(e)}}}},1073:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.signupRoutes=void 0;const s=r(6860),a=r(8809),n=r(2541),i=o(r(3320)),d=r(7564),u=r(287);t.signupRoutes=(0,s.Router)(),t.signupRoutes.post("/",...(0,u.AdaptRouteMiddleware)((0,i.default)(d.schemaSignup)),(0,a.AdaptRoute)((0,n.makeSignupController)()))},4469:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaSignup=void 0;const o=r(286),s=r(3405),a=r(4658);t.schemaSignup=a.Validator.object().keys({name:a.Validator.string().alphanum().min(3).max(60).required(),password:a.Validator.string().min(6).max(30).required(),email:(0,o.ValidatorEmail)(s.emailValidator).email().required()})},7116:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateTokenRoutes=t.ValidateTokenController=void 0;var o=r(8682);Object.defineProperty(t,"ValidateTokenController",{enumerable:!0,get:function(){return o.ValidateTokenController}});var s=r(6738);Object.defineProperty(t,"validateTokenRoutes",{enumerable:!0,get:function(){return s.validateTokenRoutes}})},8682:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidateTokenController=void 0;const o=r(5822),s=r(8119);t.ValidateTokenController=class{async handle(e){try{const t=e.body.session;return(0,o.ok)({data:t,message:"valid token"})}catch(e){return s.Logger.error("ValidateTokenController",e),(0,o.serverError)(e)}}}},6738:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateTokenRoutes=void 0;const o=r(6860),s=r(6628),a=r(8809);t.validateTokenRoutes=(0,o.Router)(),t.validateTokenRoutes.get("/",(0,a.AdaptRoute)((0,s.makeValidateTokenController)()))},9482:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SendEmail=void 0;const s=o(r(5184)),a=r(3405),n=r(4093),i=s.default.createTransport({host:n.email.host,port:n.email.port,auth:{user:n.email.user,pass:n.email.password}});t.SendEmail=async e=>{const t=Object.assign(e,{from:"api <noreplay@api.com>"});return await new Promise(((e,r)=>{i.sendMail(t,((o,s)=>{if(null!==o)return a.Logger.error(`Error occurred while sending an email to ${t.to}`,o.message),void r(o);a.Logger.info(`Message sent a ${t.to} successfully!`),e(!0),i.close()}))}))}},8168:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.emailValidator=void 0,t.emailValidator={isValid:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},3405:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.emailValidator=void 0;var o=r(8168);Object.defineProperty(t,"emailValidator",{enumerable:!0,get:function(){return o.emailValidator}});var s=r(8119);Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return s.Logger}})},8119:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.Logger={info:(...e)=>{e.forEach((e=>{console.info(e)}))},debug:(...e)=>{e.forEach((e=>{console.debug(e)}))},error:(e,t="")=>{console.error(`âš ï¸  ${e} âš ï¸ `,t)}}},3533:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restorePasswordText=t.restorePasswordHtml=void 0,t.restorePasswordHtml=e=>`<h1 style="\ntext-align: center;\nfont-family: Arial, Helvetica;\n">Restore Password</h1>\n<p style="font-family: Arial, Helvetica;">Hello, you have requested to reset your password, click on the following link to reset it, this link is temporary, so if it expires, request it again</p>\n\n<a style="\ndisplay: block;\nfont-family: Arial, Helvetica;\npadding: 1rem;\nbackground-color: #00C897;\ncolor: white;\ntext-transform: uppercase;\ntext-align: center;\ntext-decoration: none;\n" href="${e}">Go to Reset Password</a>\n\n<p style="font-family: Arial, Helvetica;">If you cannot access this link, visit : ${e}</p>\n\n<p style="font-family: Arial, Helvetica;">If you did not request this email, you can ignore it</p>`,t.restorePasswordText=e=>`\nRestore Password\nHello, you have requested to reset your password, click on the following link to reset it, this link is temporary, so if it expires, request it again\nReset password:\n${e}\nIf you did not request this email, you can ignore it`},3317:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(6113));t.default=class{constructor(e,t,r=1e3){this.password=e,this.Salt=t,this.iterations=r,this.GetBytes=e=>{const t=this.pbkdf2.slice(this.fromIndex,e+this.fromIndex);return this.fromIndex=e,t},this.fromIndex=0,this.IterationCount=r,this.HashAlgorithm="sha1",this.pbkdf2=s.default.pbkdf2Sync(e,this.Salt,r,48,this.HashAlgorithm)}}},1990:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(6113));t.default=class{constructor(){this.Key=s.default.randomBytes(32),this.IV=s.default.randomBytes(16),this.KeySize=256,this.BlockSize=128}}},3215:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Rijndael=void 0;var s=r(2270);Object.defineProperty(t,"Rijndael",{enumerable:!0,get:function(){return o(s).default}})},2270:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(6113)),a=o(r(3317)),n=o(r(1990));t.default=(e,t,r)=>{const o=new a.default(t,e),i=new n.default;i.Key=o.GetBytes(i.KeySize/8),i.IV=o.GetBytes(i.BlockSize/8);const d=s.default.createCipheriv("aes256",i.Key,i.IV);return Buffer.concat([d.update(r),d.final()]).toString("base64")}},4658:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(8960),t)},8960:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=void 0;const s=o(r(8506));t.Validator=s.default},1115:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRepository=void 0;const o=r(2282);t.BaseRepository=class{constructor(e,t=o.MongoHelper.connection()){this.collection=t?.collection(e)}async create(e){const t=await this.collection.insertOne(e);return Object.assign(e,{_id:t.insertedId.toHexString()}),e}async update(e,t){const r={$set:t};return(await this.collection.findOneAndUpdate(e,r)).value}async delete(e){return 1===(await this.collection.deleteOne(e)).deletedCount}async find(e){return await this.collection.find(e)}async findOne(e){return await this.collection.findOne(e)}async findByPk(e){return await this.collection.findOne({_id:e})}}},7050:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionRepository=void 0;const o=r(1115);class s extends o.BaseRepository{constructor(){super("sessions")}async findByUserId(e){return await this.findOne({user_id:e})}async findByToken(e){return await this.findOne({token:e})}async updateByPk(e,t){return await this.update({_id:e},t)}}t.SessionRepository=s},7031:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserRepository=void 0;const o=r(1115);class s extends o.BaseRepository{constructor(){super("users")}async findByEmail(e){return await this.findOne({email:e})}}t.UserRepository=s},7455:e=>{e.exports=require("compression")},6860:e=>{e.exports=require("express")},7806:e=>{e.exports=require("helmet")},8506:e=>{e.exports=require("joi")},9344:e=>{e.exports=require("jsonwebtoken")},8013:e=>{e.exports=require("mongodb")},5184:e=>{e.exports=require("nodemailer")},9948:e=>{e.exports=require("swagger-ui-express")},6113:e=>{e.exports=require("crypto")}},t={};!function r(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}(5401)})();